
#include "unity.h"
#include "xmath.h"

/*
Generated with python
for i in range(12):
    for k in [2, 3, 5, 7]:
        x = k * pow(10, i)
        print(f"{{1. / {x}., {log(1/x):.53f}}},")
        print(f"{{1. + 1. / {x}., {log(1 + 1/x):.53f}}},")
        print(f"{{1. - 1. / {x}., {log(1 - 1/x):.53f}}},")
# and
for i in range(12):
    for k in [2, 3, 5, 7]:
        x = k * pow(10, i)
        print(f"{{{x}., {log(x):.53f}}},")

*/
double const log_table[][2] = {
    {1. / 2., -0.69314718055994528622676398299518041312694549560546875},
    {1. + 1. / 2., 0.40546510810816438485915114142699167132377624511718750},
    {1. - 1. / 2., -0.69314718055994528622676398299518041312694549560546875},
    {1. / 3., -1.09861228866810978210821758693782612681388854980468750},
    {1. + 1. / 3., 0.28768207245178084585646161031036172062158584594726562},
    {1. - 1. / 3., -0.40546510810816427383684867891133762896060943603515625},
    {1. / 5., -1.60943791243410028179994242236716672778129577636718750},
    {1. + 1. / 5., 0.18232155679395459224600983816344523802399635314941406},
    {1. - 1. / 5., -0.22314355131420970934641445637680590152740478515625000},
    {1. / 7., -1.94591014905531345391409558942541480064392089843750000},
    {1. + 1. / 7., 0.13353139262452257129965005333360750228166580200195312},
    {1. - 1. / 7., -0.15415067982725821904566032571892719715833663940429688},
    {1. / 20., -2.99573227355399085425347038835752755403518676757812500},
    {1. + 1. / 20., 0.04879016416943204870193540045875124633312225341796875},
    {1. - 1. / 20., -0.05129329438755057812837634401148534379899501800537109},
    {1. / 30., -3.40119738166215546115722645481582731008529663085937500},
    {1. + 1. / 30., 0.03278982282299097023026135389045521151274442672729492},
    {1. - 1. / 30., -0.03390155167568133925959372731995244976133108139038086},
    {1. / 50., -3.91202300542814596084895129024516791105270385742187500},
    {1. + 1. / 50., 0.01980262729617972977669282386159466113895177841186523},
    {1. - 1. / 50., -0.02020270731751946588494739387442677980288863182067871},
    {1. / 70., -4.24849524204935935500770938233472406864166259765625000},
    {1. + 1. / 70., 0.01418463499195638140293329598762284149415791034698486},
    {1. - 1. / 70., -0.01438873745209955611057406343888942501507699489593506},
    {1. / 200., -5.29831736654803631125787433120422065258026123046875000},
    {1. + 1. / 200., 0.00498754151103896793684189248097027302719652652740479},
    {1. - 1. / 200., -0.00501254182354428628326514782997946895193308591842651},
    {1. / 300., -5.70378247465620091816163039766252040863037109375000000},
    {1. + 1. / 300., 0.00332779009267474565683664344817316305125132203102112},
    {1. - 1. / 300., -0.00333890126551459861040105359109020355390384793281555},
    {1. / 500., -6.21460809842219141785335523309186100959777832031250000},
    {1. + 1. / 500., 0.00199800266267305794490316550593433930771425366401672},
    {1. - 1. / 500., -0.00200200267067307926052710520536948024528101086616516},
    {1. / 700., -6.55108033504340436792290347511880099773406982421875000},
    {1. + 1. / 700., 0.00142755199118532369838285855934145729406736791133881},
    {1. - 1. / 700., -0.00142959280959443352232440815896552521735429763793945},
    {1. / 2000., -7.60090245954208221235148812411352992057800292968750000},
    {1. + 1. / 2000., 0.00049987504165099286984608184525313845369964838027954},
    {1. - 1. / 2000.,
     -0.00050012504168224286224542218803890136769041419029236},
    {1. / 3000., -8.00636756765024593107682449044659733772277832031250000},
    {1. + 1. / 3000., 0.00033327779012033448974294813638152845669537782669067},
    {1. - 1. / 3000.,
     -0.00033338890123761844236707774236094792286166921257973},
    {1. / 5000., -8.51719319141623820712538872612640261650085449218750000},
    {1. + 1. / 5000., 0.00019998000266624471350090930243936782062519341707230},
    {1. - 1. / 5000.,
     -0.00020002000266704469846716640812900322998757474124432},
    {1. / 7000., -8.85366542803745026901651726802811026573181152343750000},
    {1. + 1. / 7000., 0.00014284693974730280972666729422115849956753663718700},
    {1. - 1. / 7000.,
     -0.00014286734791066533719651465705879900269792415201664},
    {1. / 20000., -9.90348755253612722526668221689760684967041015625000000},
    {1. + 1. / 20000.,
     0.00004999875004177061290928235637309740013733971863985},
    {1. - 1. / 20000.,
     -0.00005000125004166271994610754036969524349842686206102},
    {1. / 30000., -10.30895266064429272034885798348113894462585449218750000},
    {1. + 1. / 30000.,
     0.00003333277779011947962060566363895475205936236307025},
    {1. - 1. / 30000.,
     -0.00003333388890123120754929372799857389964017784222960},
    {1. / 50000., -10.81977828441028322004058281891047954559326171875000000},
    {1. + 1. / 50000.,
     0.00001999980000257560816155286143036562407360179349780},
    {1. - 1. / 50000.,
     -0.00002000020000268670926813104060659753713480313308537},
    {1. / 70000., -11.15625052103149528193171136081218719482421875000000000},
    {1. + 1. / 70000.,
     0.00001428561224589991270517326527045298689699848182499},
    {1. - 1. / 70000.,
     -0.00001428581632753258733785437645247284876859339419752},
    {1. / 200000., -12.20607264553017401453871570993214845657348632812500000},
    {1. + 1. / 200000.,
     0.00000499998750007442239041803577759282006809371523559},
    {1. - 1. / 200000.,
     -0.00000500001250007442329226876528980305636196135310456},
    {1. / 300000., -12.61153775363833773326405207626521587371826171875000000},
    {1. + 1. / 300000.,
     0.00000333332777781196089989228931171894032559066545218},
    {1. - 1. / 300000.,
     -0.00000333333888892307189419470132840661591444586520083},
    {1. / 500000., -13.12236337740432823295577691169455647468566894531250000},
    {1. + 1. / 500000.,
     0.00000199999800006017773354297963062098375530695193447},
    {1. - 1. / 500000.,
     -0.00000200000199994915554149526280836024483278379193507},
    {1. / 700000., -13.45883561402554207120374485384672880172729492187500000},
    {1. + 1. / 700000.,
     0.00000142857040807843417650846527117147743979330698494},
    {1. - 1. / 700000.,
     -0.00000142857244900578298812856680582994428618803794961},
    {1. / 2000000., -14.50865773852421902745390980271622538566589355468750000},
    {1. + 1. / 2000000.,
     0.00000049999987506993056406265525659637916078281705268},
    {1. - 1. / 2000000.,
     -0.00000050000012495890832144062373293413870101176144090},
    {1. / 3000000., -14.91412284663238452253608556929975748062133789062500000},
    {1. + 1. / 3000000.,
     0.00000033333327782438276682110893205102097880399014684},
    {1. - 1. / 3000000.,
     -0.00000033333338893549388099929778848939943003415464773},
    {1. / 5000000., -15.42494847039837502222781040472909808158874511718750000},
    {1. + 1. / 5000000.,
     0.00000019999997989473151074793066256374274303198035341},
    {1. - 1. / 5000000.,
     -0.00000020000002000575379949151772797366621858827784308},
    {1. / 7000000., -15.76142070701958708411893894663080573081970214843750000},
    {1. + 1. / 7000000.,
     0.00000014285713257786850402503804266518550036835222272},
    {1. - 1. / 7000000.,
     -0.00000014285715309705408640220613246396563766893450520},
    {1. / 20000000.,
     -16.81124283151826404036910389550030231475830078125000000},
    {1. + 1. / 20000000.,
     0.00000004999999866817110478411586866470672774198646948},
    {1. - 1. / 20000000.,
     -0.00000005000000127919340308047603570543171436213469860},
    {1. / 30000000.,
     -17.21670793962642775909444026183336973190307617187500000},
    {1. + 1. / 30000000.,
     0.00000003333333287125489138646178429413458044194840113},
    {1. - 1. / 30000000.,
     -0.00000003333333387134370774196410330825202095184067730},
    {1. / 50000000.,
     -17.72753356339242003514300449751317501068115234375000000},
    {1. + 1. / 50000000.,
     0.00000001999999990049518544283405866324870858719009448},
    {1. - 1. / 50000000.,
     -0.00000002000000018947288641654936496364070031006576755},
    {1. / 70000000.,
     -18.06400580001363209703413303941488265991210937500000000},
    {1. + 1. / 70000000.,
     0.00000001428571428717640219212204661823270579468214692},
    {1. - 1. / 70000000.,
     -0.00000001428571438023573319049740697585584858764207183},
    {1. / 200000000.,
     -19.11382792451231082964113738853484392166137695312500000},
    {1. + 1. / 200000000.,
     0.00000000499999995711264493460945733112159305999711023},
    {1. - 1. / 200000000.,
     -0.00000000499999998211264535616904549080070918609663977},
    {1. / 300000000.,
     -19.51929303262047454836647375486791133880615234375000000},
    {1. + 1. / 300000000.,
     0.00000000333333338153440914697426874905607230292758913},
    {1. - 1. / 300000000.,
     -0.00000000333333339264552099689893852204301827324428587},
    {1. / 500000000.,
     -20.03011865638646682441503799054771661758422851562500000},
    {1. + 1. / 500000000.,
     0.00000000199999994143613718831718215420984591235153971},
    {1. - 1. / 500000000.,
     -0.00000000200000005645843983408765605954554578360671258},
    {1. / 700000000.,
     -20.36659089300767888630616653244942426681518554687500000},
    {1. + 1. / 700000000.,
     0.00000000142857148231023473477398030335875148133517598},
    {1. - 1. / 700000000.,
     -0.00000000142857148435105101975205369417695408507107402},
    {1. / 2000000000.,
     -21.41641301750635761891317088156938552856445312500000000},
    {1. + 1. / 2000000000.,
     0.00000000050000004124518548089377656618243275787882851},
    {1. - 1. / 2000000000.,
     -0.00000000050000004149518551819659694990033091399617149},
    {1. / 3000000000.,
     -21.82187812561452133763850724790245294570922851562500000},
    {1. + 1. / 3000000000.,
     0.00000000033333336085790143010741016624980722488080787},
    {1. - 1. / 3000000000.,
     -0.00000000033333336096901256928617217780536855636919213},
    {1. / 5000000000.,
     -22.33270374938051006097339268308132886886596679687500000},
    {1. + 1. / 5000000000.,
     0.00000000020000001652807418752806718129755953958226478},
    {1. - 1. / 5000000000.,
     -0.00000000020000001656807421210808222513554592916773522},
    {1. / 7000000000.,
     -22.66917598600172567557820002548396587371826171875000000},
    {1. + 1. / 7000000000.,
     0.00000000014285705950501824352671845887115297316083407},
    {1. - 1. / 7000000000.,
     -0.00000000014285717054772885441649251546451749803057218},
    {1. / 20000000000.,
     -23.71899811050040085547152557410299777984619140625000000},
    {1. + 1. / 20000000000.,
     0.00000000005000000413576855080198033957683328640242415},
    {1. - 1. / 20000000000.,
     -0.00000000005000000413826854910705701203144308078507585},
    {1. / 30000000000.,
     -24.12446321860856812691054074093699455261230468750000000},
    {1. + 1. / 30000000000.,
     0.00000000003333333609079014479077318999062327919968851},
    {1. - 1. / 30000000000.,
     -0.00000000003333333609190125514858504441489429892531149},
    {1. / 50000000000.,
     -24.63528884237455685024542617611587047576904296875000000},
    {1. + 1. / 50000000000.,
     0.00000000002000000165460741998815436581387591568823026},
    {1. - 1. / 50000000000.,
     -0.00000000002000000165500741997546057482943463118676974},
    {1. / 70000000000.,
     -24.97176107899576891213655471801757812500000000000000000},
    {1. + 1. / 70000000000.,
     0.00000000001428568374695969878487037947766198110743918},
    {1. - 1. / 70000000000.,
     -0.00000000001428568374716377975162369677432166147068582},
    {1. / 200000000000.,
     -26.02158320349444764474355906713753938674926757812500000},
    {1. + 1. / 200000000000.,
     0.00000000000500000041368935519779694028525663068544815},
    {1. - 1. / 200000000000.,
     -0.00000000000500000041371435479310679487557100603330185},
    {1. / 300000000000.,
     -26.42704831160261136346889543347060680389404296875000000},
    {1. + 1. / 300000000000.,
     0.00000000000333333360912901439671123843137555848312528},
    {1. - 1. / 300000000000.,
     -0.00000000000333333360914012559722458500917619932937472},
    {1. / 500000000000.,
     -26.93787393536860363951745966915041208267211914062500000},
    {1. + 1. / 500000000000.,
     0.00000000000199995575655775689504737100826307948445160},
    {1. - 1. / 500000000000.,
     -0.00000000000199995575656175708879088916553452793742340},
    {1. / 700000000000.,
     -27.27434617198981570140858821105211973190307617187500000},
    {1. + 1. / 700000000000.,
     0.00000000000142863498808663099099368429670016473922826},
    {1. - 1. / 700000000000.,
     -0.00000000000142852396578620916383814006455253914958797},
    {2., 0.69314718055994528622676398299518041312694549560546875},
    {3., 1.09861228866810978210821758693782612681388854980468750},
    {5., 1.60943791243410028179994242236716672778129577636718750},
    {7., 1.94591014905531323186949066439410671591758728027343750},
    {20., 2.99573227355399085425347038835752755403518676757812500},
    {30., 3.40119738166215546115722645481582731008529663085937500},
    {50., 3.91202300542814596084895129024516791105270385742187500},
    {70., 4.24849524204935935500770938233472406864166259765625000},
    {200., 5.29831736654803631125787433120422065258026123046875000},
    {300., 5.70378247465620091816163039766252040863037109375000000},
    {500., 6.21460809842219141785335523309186100959777832031250000},
    {700., 6.55108033504340436792290347511880099773406982421875000},
    {2000., 7.60090245954208221235148812411352992057800292968750000},
    {3000., 8.00636756765024593107682449044659733772277832031250000},
    {5000., 8.51719319141623820712538872612640261650085449218750000},
    {7000., 8.85366542803745026901651726802811026573181152343750000},
    {20000., 9.90348755253612722526668221689760684967041015625000000},
    {30000., 10.30895266064429272034885798348113894462585449218750000},
    {50000., 10.81977828441028322004058281891047954559326171875000000},
    {70000., 11.15625052103149528193171136081218719482421875000000000},
    {200000., 12.20607264553017401453871570993214845657348632812500000},
    {300000., 12.61153775363833773326405207626521587371826171875000000},
    {500000., 13.12236337740432823295577691169455647468566894531250000},
    {700000., 13.45883561402554207120374485384672880172729492187500000},
    {2000000., 14.50865773852421902745390980271622538566589355468750000},
    {3000000., 14.91412284663238452253608556929975748062133789062500000},
    {5000000., 15.42494847039837502222781040472909808158874511718750000},
    {7000000., 15.76142070701958708411893894663080573081970214843750000},
    {20000000., 16.81124283151826404036910389550030231475830078125000000},
    {30000000., 17.21670793962642775909444026183336973190307617187500000},
    {50000000., 17.72753356339242003514300449751317501068115234375000000},
    {70000000., 18.06400580001363209703413303941488265991210937500000000},
    {200000000., 19.11382792451231082964113738853484392166137695312500000},
    {300000000., 19.51929303262047454836647375486791133880615234375000000},
    {500000000., 20.03011865638646682441503799054771661758422851562500000},
    {700000000., 20.36659089300767888630616653244942426681518554687500000},
    {2000000000., 21.41641301750635761891317088156938552856445312500000000},
    {3000000000., 21.82187812561452133763850724790245294570922851562500000},
    {5000000000., 22.33270374938051006097339268308132886886596679687500000},
    {7000000000., 22.66917598600172567557820002548396587371826171875000000},
    {20000000000., 23.71899811050040085547152557410299777984619140625000000},
    {30000000000., 24.12446321860856812691054074093699455261230468750000000},
    {50000000000., 24.63528884237455685024542617611587047576904296875000000},
    {70000000000., 24.97176107899576891213655471801757812500000000000000000},
    {200000000000., 26.02158320349444764474355906713753938674926757812500000},
    {300000000000., 26.42704831160261136346889543347060680389404296875000000},
    {500000000000., 26.93787393536860363951745966915041208267211914062500000},
    {700000000000., 27.27434617198981570140858821105211973190307617187500000},
};

int const log_table_size = sizeof(log_table) / (2 * sizeof(double));

/*
for i in range(8):
    for k in range(1,10,2):
        x = k * pow(10, i)
        print(f"{{1./{x}., {exp(1./x):.53f}}},")

*/
double const exp_table[][2] = {
    {1. / 3., 1.39561242508608951418125343479914590716361999511718750},
    {1. / 5., 1.22140275816016985466205824195640161633491516113281250},
    {1. / 7., 1.15356499489510766487398996105184778571128845214843750},
    {1. / 9., 1.11751906874186368590073925588512793183326721191406250},
    {1. / 10., 1.10517091807564771244187795673497021198272705078125000},
    {1. / 30., 1.03389511351357410440243711491348221898078918457031250},
    {1. / 50., 1.02020134002675577633567627344746142625808715820312500},
    {1. / 70., 1.01438824275104799710334191331639885902404785156250000},
    {1. / 90., 1.01117306876633783474517258582636713981628417968750000},
    {1. / 100., 1.01005016708416794912750447110738605260848999023437500},
    {1. / 300., 1.00333889506687579107335750450147315859794616699218750},
    {1. / 500., 1.00200200133400030289010373962810263037681579589843750},
    {1. / 700., 1.00142959232281691939192569407168775796890258789062500},
    {1. / 900., 1.00111172862374897540860274602891877293586730957031250},
    {1. / 1000., 1.00100050016670838459731385228224098682403564453125000},
    {1. / 3000., 1.00033338889506229207881915499456226825714111328125000},
    {1. / 5000., 1.00020002000133345632093551103025674819946289062500000},
    {1. / 7000., 1.00014286734742463558234248921507969498634338378906250},
    {1. / 9000., 1.00011111728417922961398289771750569343566894531250000},
    {1. / 10000., 1.00010000500016671409753143962007015943527221679687500},
    {1. / 30000., 1.00003333388889514843356209894409403204917907714843750},
    {1. / 50000., 1.00002000020000125779517929913708940148353576660156250},
    {1. / 70000., 1.00001428581632700876014041568851098418235778808593750},
    {1. / 90000., 1.00001111117283980611603055876912549138069152832031250},
    {1. / 100000., 1.00001000005000006964905878703575581312179565429687500},
    {1. / 300000., 1.00000333333888891118590436235535889863967895507812500},
    {1. / 500000., 1.00000200000200001326788878941442817449569702148437500},
    {1. / 700000., 1.00000142857244900262969622417585924267768859863281250},
    {1. / 900000., 1.00000111111172840239191828004550188779830932617187500},
    {1. / 1000000., 1.00000100000049996218365322420140728354454040527343750},
    {1. / 3000000., 1.00000033333338889107722025073599070310592651367187500},
    {1. / 5000000., 1.00000020000002010078787861857563257217407226562500000},
    {1. / 7000000., 1.00000014285715299600099115195916965603828430175781250},
    {1. / 9000000., 1.00000011111111719586119761515874415636062622070312500},
    {1. / 10000000., 1.00000010000000494336802603356773033738136291503906250},
    {1. / 30000000., 1.00000003333333387089965071936603635549545288085937500},
    {1. / 50000000., 1.00000002000000010049518550658831372857093811035156250},
    {1. / 70000000., 1.00000001428571438921721892256755381822586059570312500},
    {1. / 90000000., 1.00000001111111114227014695643447339534759521484375000},
    {1., 2.71828182845904509079559829842764884233474731445312500},
    {-1., 0.36787944117144233402427744294982403516769409179687500},
    {2., 7.38905609893065040694182243896648287773132324218750000},
    {-2., 0.13533528323661270231781372785917483270168304443359375},
    {3., 20.08553692318766792368478490971028804779052734375000000},
    {-3., 0.04978706836786394446248138478949840646237134933471680},
    {4., 54.59815003314423620395245961844921112060546875000000000},
    {-4., 0.01831563888873417866864912184610147960484027862548828},
    {5., 148.41315910257659993476408999413251876831054687500000000},
    {-5., 0.00673794699908546700084510661099557182751595973968506},
    {6., 403.42879349273511024875915609300136566162109375000000000},
    {-6., 0.00247875217666635849073086816929389897268265485763550},
    {7., 1096.63315842845850056619383394718170166015625000000000000},
    {-7., 0.00091188196555451624374794006300248838670086115598679},
    {8., 2980.95798704172830184688791632652282714843750000000000000},
    {-8., 0.00033546262790251185322357163620665687631117179989815},
    {9., 8103.08392757538422301877290010452270507812500000000000000},
    {-9., 0.00012340980408667956121429587490467838506447151303291},
    {10., 22026.46579480671789497137069702148437500000000000000000000},
    {-10., 0.00004539992976248485417314557088808157914172625169158},
    {11., 59874.14171519781666574999690055847167968750000000000000000},
    {-11., 0.00001670170079024565926249096259326165636593941599131},
    {12., 162754.79141900391550734639167785644531250000000000000000000},
    {-12., 0.00000614421235332820980644006822468661255243205232546},
    // {13., 442413.39200892049120739102363586425781250000000000000000000},
    // {-13., 0.00000226032940698105423954315795764813401547144167125},
    // {14., 1202604.28416477679274976253509521484375000000000000000000000},
    // {-14., 0.00000083152871910356787708981044643374858083006984089},
};

int const exp_table_size = sizeof(exp_table) / (2 * sizeof(double));

static const char *precision_estimation_fmt =
    "{\"depth\":%d, \"precision\":%E, \"relative_precision\":%E}";

double const precision = 1e-10;

static double dabs(double x) {
    if (x < 0) {
        return -x;
    }
    return x;
}

static char buffer[256];

void test_log(void) {
    TEST_ASSERT_DOUBLE_IS_NAN(log(_NAN));
    TEST_ASSERT_DOUBLE_IS_NAN(log(-1));
    TEST_ASSERT_DOUBLE_IS_NEG_INF(log(0));
    TEST_ASSERT(log(1) == 0);
    for (int i = 0; i < log_table_size; ++i) {
        sprintf(buffer, "[%d] log(%f) = %.18f != %.18f\n", i, log_table[i][0],
                log(log_table[i][0]), log_table[i][1]);
        TEST_ASSERT_DOUBLE_WITHIN_MESSAGE(precision, log_table[i][1],
                                          log(log_table[i][0]), buffer);
    }
}

void test_log_estimate_precision(void) {
    double worst_precision = 0.0;
    double worst_relative_precision = 0.0;
    double error = 0.0;
    double relative_error = 0.0;

    for (int i = 0; i < log_table_size; ++i) {
        error = dabs(log(log_table[i][0]) - log_table[i][1]);
        if (error > worst_precision) {
            worst_precision = error;
        }
        relative_error = error / dabs(log_table[i][1]);
        if (relative_error > worst_relative_precision) {
            worst_relative_precision = relative_error;
        }
    }
    sprintf(buffer, precision_estimation_fmt, LOG_CF_DEPTH, worst_precision,
            worst_relative_precision);
    TEST_MESSAGE(buffer);
}

void test_exp(void) {
    TEST_ASSERT_DOUBLE_IS_NAN(exp(_NAN));
    TEST_ASSERT(exp(0) == 1);
    for (int i = 0; i < exp_table_size; ++i) {
        sprintf(buffer, "[%d] exp(%f) = %.18f != %.18f\n", i, exp_table[i][0],
                exp(exp_table[i][0]), exp_table[i][1]);
        TEST_ASSERT_DOUBLE_WITHIN_MESSAGE(precision, exp_table[i][1],
                                          exp(exp_table[i][0]), buffer);
    }
}

void test_exp_estimate_precision(void) {
    double worst_precision = 0.0;
    double worst_relative_precision = 0.0;
    double error = 0.0;
    double relative_error = 0.0;

    for (int i = 0; i < exp_table_size; ++i) {
        error = dabs(exp(exp_table[i][0]) - exp_table[i][1]);
        if (error > worst_precision) {
            worst_precision = error;
        }
        relative_error = error / exp_table[i][1];
        if (relative_error > worst_relative_precision) {
            worst_relative_precision = relative_error;
        }
    }
    sprintf(buffer, precision_estimation_fmt, EXP_CF_DEPTH, worst_precision,
            worst_relative_precision);
    TEST_MESSAGE(buffer);
}

void test_pow(void) {
    for (int i = 0; i < 20; ++i) {
        TEST_ASSERT_EQUAL_DOUBLE(1., pow(1., (double)i));
    }

    double q = 2.0;
    double d = q;
    int i;
    for (d = 1, i = 0; i < 20; ++i, d *= q) {
        TEST_ASSERT_EQUAL_DOUBLE(d, pow(q, (double)i));
    }
}

void test_min(void) {
    TEST_ASSERT_EQUAL_DOUBLE(1, min(1, 2));
    TEST_ASSERT_EQUAL_DOUBLE(1, min(2, 1));
    TEST_ASSERT_EQUAL_DOUBLE(-2, min(1, -2));
    TEST_ASSERT_EQUAL_DOUBLE(-2, min(-2, 1));
    TEST_ASSERT_EQUAL_DOUBLE(7, min(7, 7));
    TEST_ASSERT_EQUAL_DOUBLE(0, min(0, _INFINITY));
    TEST_ASSERT_EQUAL_DOUBLE(0, min(_INFINITY, 0));
    TEST_ASSERT_DOUBLE_IS_NEG_INF(min(0, -_INFINITY));
    TEST_ASSERT_DOUBLE_IS_NEG_INF(min(-_INFINITY, 0));
    TEST_ASSERT_DOUBLE_IS_NAN(min(0, _NAN));
    TEST_ASSERT_DOUBLE_IS_NAN(min(_NAN, 0));
}

void test_is_nan(void) {
    double const nan = _NAN;
    TEST_ASSERT_DOUBLE_IS_NAN(nan);
    TEST_ASSERT(is_nan(nan));
    // TEST_ASSERT(is_inf(-_INFINITY));
}

void setUp(void) {}

void tearDown(void) {}

int main(void) {
    UNITY_BEGIN();
    RUN_TEST(test_log);
    RUN_TEST(test_log_estimate_precision);
    RUN_TEST(test_exp);
    RUN_TEST(test_exp_estimate_precision);
    RUN_TEST(test_min);
    RUN_TEST(test_is_nan);
    RUN_TEST(test_pow);
    return UNITY_END();
}