<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Tutorial</title>

	<link rel="stylesheet" href="/libspot/css/main.css">
	<link rel="canonical" href="http://localhost:4000/libspot/tuto/">
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800,600' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Muli:400,300,700,800,600' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Oswald:400,300,700,800,600' rel='stylesheet' type='text/css'>
	
	<link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
</head> 

	<div id="page">
		<div class="topbar">
	<div class="title">
		<a href="/libspot/">libspot</a>
	</div>

	<div class="tab">
	 
		<a href="/libspot/index.html">Home</a>
	  
		<a href="/libspot/tuto/">Tutorial</a>
	  
		<a href="/libspot/python/">Python</a>
	  
		<a href="/libspot/download/">Download</a>
	  
		<a href="/libspot/about/">About</a>
	       
	</div>
	
	
</div>


		<header>
			<h1>Tutorial</h1>
		</header>
		<body>
			<main><p><a name="intro"></a>
<a name="buildspot"></a></p>
<h3 id="introduction">INTRODUCTION</h3>
<p><strong>libspot</strong> is based on the core algorithm <strong>SPOT</strong> which detects anomalies. This algorithm is a part of the main object <code class="language-c++ highlighter-rouge"><span class="n">SPOT</span></code>.</p>

<h3 id="construct-a-spot-object">CONSTRUCT A SPOT OBJECT</h3>

<p>Here is the full constructor of the <code class="language-c++ highlighter-rouge"><span class="n">SPOT</span></code> object:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Spot</span><span class="p">(</span><span class="kt">double</span> <span class="n">q</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n_init</span><span class="p">,</span> <span class="kt">double</span> <span class="n">level</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">up</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">down</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">alert</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">bounded</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_excess</span><span class="p">);</span>
</code></pre></div></div>

<p>The main parameter is <code>q</code>. It defines the probability of an abnormal event. For example, if <code class="language-c++ highlighter-rouge"><span class="n">q</span> <span class="o">=</span> <span class="mf">0.001</span></code>, it means that the algorithm will consider events with a probability lower than <code class="language-c++ highlighter-rouge"><span class="n">q</span></code> as abnormal.</p>

<p>The parameters <code class="language-c++ highlighter-rouge"><span class="n">n_init</span></code> and <code class="language-c++ highlighter-rouge"><span class="n">level</span></code> are involved in the calibration step of the algorithm. <code class="language-c++ highlighter-rouge"><span class="n">n_init</span></code> is the number of data required to calibrate and <code class="language-c++ highlighter-rouge"><span class="n">level</span></code> is the proportion of these initial data not involved in the tail distribution fit. For example, let us use <code class="language-c++ highlighter-rouge"><span class="n">n_init</span> <span class="o">=</span> <span class="mi">1000</span></code> and <code class="language-c++ highlighter-rouge"><span class="n">level</span> <span class="o">=</span> <span class="mf">0.99</span></code>. The algorithm will drop the 990 lowest data and will keep the 10 highest to make a first fit.</p>

<div class="alert">
In practice, the user must ensure that <code>n_init * (1 - level) &gt; 10</code> to have enough data for the fit (at least 10). Furthermore, the <code>level</code> must be high enough to reduce the bias of the algorithm. We may advice to have the <code>level</code> as close to 1 as possible.
</div>

<p>The booleans <code class="language-c++ highlighter-rouge"><span class="n">up</span></code> and <code class="language-c++ highlighter-rouge"><span class="n">down</span></code> define whether the algorithm computes upper/lower thresholds or not.</p>

<p>The boolean <code class="language-c++ highlighter-rouge"><span class="n">alert</span> <span class="o">=</span> <span class="nb">true</span></code> enables alert triggering. If <code class="language-c++ highlighter-rouge"><span class="n">alert</span> <span class="o">=</span> <span class="nb">false</span></code>, it means that all the data (even those out of the bounds) will be taken into account.</p>

<p>The boolean <code class="language-c++ highlighter-rouge"><span class="n">bounded</span> <span class="o">=</span> <span class="nb">true</span></code> enables the memory bounding. The bound is given by <code class="language-c++ highlighter-rouge"><span class="n">max_excess</span></code> which is the maximum number of data stored to perform the tail fit.
<a name="buildotherspot"></a></p>
<div class="alert">
If the memory is not bounded, the algorithm will store more and more data to perform the tail fit. However, the computation time will cause more problems than the memory growth because the tail fit complexity depends on this number of stored data.
</div>

<h3 id="other-constructors">OTHER CONSTRUCTORS</h3>
<p><strong>libspot</strong> provides other constructors. For instance rather than specifying <code class="language-c++ highlighter-rouge"><span class="n">n_init</span></code> (the number of data to calibrate), the user can provide an initial batch of data <code class="language-c++ highlighter-rouge"><span class="n">init_data</span></code>. This batch will directly be used to perform the calibration.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Spot</span><span class="p">(</span><span class="kt">double</span> <span class="n">q</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">init_data</span><span class="p">,</span> <span class="kt">double</span> <span class="n">level</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">up</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">down</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">alert</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">bounded</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_excess</span><span class="p">);</span>
</code></pre></div></div>

<p>Finally, shorter constructors can also be used:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Spot</span><span class="p">(</span><span class="kt">double</span> <span class="n">q</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n_init</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">);</span>
<span class="n">Spot</span><span class="p">(</span><span class="kt">double</span> <span class="n">q</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">init_data</span><span class="p">);</span>
</code></pre></div></div>

<p>The default values of the parameters are the following:
<a name="runspot"></a></p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">;</span>
<span class="n">n_init</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="n">level</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">;</span>
<span class="n">up</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">down</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">alert</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">bounded</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">max_excess</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="run-spot">RUN SPOT</h3>

<p>Once a <code class="language-c++ highlighter-rouge"><span class="n">SPOT</span></code> object is created you can feed it with data through the <code class="language-c++ highlighter-rouge"><span class="n">step</span></code> method.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">Spot</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></div>
<p>According to the state of the algorithm or the detected event, this method returns an enum item <code class="language-c++ highlighter-rouge"><span class="n">SPOTEVENT</span><span class="o">::</span></code> (corresponding to an integer).</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">enum item</th>
      <th style="text-align: center">integer</th>
      <th style="text-align: left">meaning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">NORMAL</td>
      <td style="text-align: center">0</td>
      <td style="text-align: left">Normal data</td>
    </tr>
    <tr>
      <td style="text-align: left">ALERT_UP</td>
      <td style="text-align: center">1</td>
      <td style="text-align: left">Abnormal data (too high)</td>
    </tr>
    <tr>
      <td style="text-align: left">ALERT_DOWN</td>
      <td style="text-align: center">-1</td>
      <td style="text-align: left">Abnormal data (too low)</td>
    </tr>
    <tr>
      <td style="text-align: left">EXCESS_UP</td>
      <td style="text-align: center">2</td>
      <td style="text-align: left">Excess (update the up model)</td>
    </tr>
    <tr>
      <td style="text-align: left">EXCESS_DOWN</td>
      <td style="text-align: center">-2</td>
      <td style="text-align: left">Excess (update the down model)</td>
    </tr>
    <tr>
      <td style="text-align: left">INIT_BATCH</td>
      <td style="text-align: center">3</td>
      <td style="text-align: left">Data for initial batch</td>
    </tr>
    <tr>
      <td style="text-align: left">CALIBRATION</td>
      <td style="text-align: center">4</td>
      <td style="text-align: left">Calibration step</td>
    </tr>
  </tbody>
</table>

<p><a name="example"></a></p>
<h3 id="example">EXAMPLE</h3>

<p>Here we give an example where Spot is applied on a Gaussian white noise of 10000 values.</p>

<p><a></a></p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// main.cpp</span>

<span class="cp">#include "spot.h"
#include &lt;random&gt;
#include &lt;iostream&gt;    
#include &lt;algorithm&gt;    
#include &lt;vector&gt;
#include &lt;math.h&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">gaussian_white_noise</span><span class="p">(</span><span class="kt">double</span> <span class="n">mu</span><span class="p">,</span> <span class="kt">double</span> <span class="n">sigma</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
	<span class="n">random_device</span> <span class="n">rd</span><span class="p">;</span>
	<span class="n">default_random_engine</span> <span class="n">gen</span><span class="p">(</span><span class="n">rd</span><span class="p">());</span>
	<span class="n">normal_distribution</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="n">sigma</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">gen</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">gaussian_white_noise</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">nb_up_alarm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nb_down_alarm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  	<span class="n">Spot</span> <span class="n">S</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">output</span><span class="p">;</span>

	<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span> <span class="n">x</span> <span class="o">:</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">output</span> <span class="o">=</span> <span class="n">S</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">output</span> <span class="o">==</span> <span class="n">SPOTVEVENT</span><span class="o">::</span><span class="n">ALERT_UP</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">nb_up_alarm</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">output</span> <span class="o">==</span> <span class="n">SPOTVEVENT</span><span class="o">::</span><span class="n">ALERT_DOWN</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">nb_down_alarm</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"#Up Alerts: "</span> <span class="o">&lt;&lt;</span> <span class="n">nb_up_alarm</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"#Down Alerts: "</span> <span class="o">&lt;&lt;</span> <span class="n">nb_down_alarm</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can compile it with <code class="language-c++ highlighter-rouge"><span class="n">g</span><span class="o">++</span></code> and the <code class="language-c++ highlighter-rouge"><span class="n">C</span><span class="o">++</span><span class="mi">14</span></code> standard:</p>
<div class="language-awk highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">g</span><span class="o">++</span> <span class="o">-</span><span class="nx">std</span><span class="o">=</span><span class="nx">c</span><span class="o">++</span><span class="mi">14</span> <span class="o">-</span><span class="nx">Wall</span> <span class="nx">main</span><span class="p">.</span><span class="nx">cpp</span> <span class="o">-</span><span class="nx">lspot</span>
</code></pre></div></div>

<!-- <noscript><pre>400: Invalid request
</pre></noscript><script src="https://gist.github.com/42d77da0c8775e1ede92bf66f7c3602a.js"> </script> -->

</main>
		</body>
		<footer>
	by @sr
</footer>

	</div>
</html>
