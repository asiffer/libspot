<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Python</title>

	<link rel="stylesheet" href="/libspot/css/main.css">
	<link rel="canonical" href="http://localhost:4000/libspot/python/">
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800,600' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Muli:400,300,700,800,600' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Oswald:400,300,700,800,600' rel='stylesheet' type='text/css'>
	
	<link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
</head> 

	<div id="page">
		<div class="topbar">
	<div class="title">
		<a href="/libspot/">libspot</a>
	</div>

	<div class="tab">
	 
		<a href="/libspot/index.html">Home</a>
	  
		<a href="/libspot/tuto/">Tutorial</a>
	  
		<a href="/libspot/python/">Python</a>
	  
		<a href="/libspot/download/">Download</a>
	  
		<a href="/libspot/about/">About</a>
	       
	</div>
	
	
</div>


		<header>
			<h1>Python</h1>
		</header>
		<body>
			<main><p>Yes, <code class="language-c++ highlighter-rouge"><span class="n">python3</span></code> bindings exist.
Thanks to the powerful built-in package <code class="language-c++ highlighter-rouge"><span class="n">ctypes</span></code> we make the use of <code class="language-c++ highlighter-rouge"><span class="n">libspot</span></code> through python possible.</p>

<h4 id="introduction">INTRODUCTION</h4>

<p>The <code class="language-c++ highlighter-rouge"><span class="n">Spot</span></code> constructor is very straightforward. We reuse the full constructor of the <code class="language-c++ highlighter-rouge"><span class="n">C</span><span class="o">++</span></code> library but without the positional argument constraint:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Spot</span><span class="p">(</span>	<span class="n">q</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
	<span class="n">up</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">down</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">alert</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
	<span class="n">bounded</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_excess</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div></div>

<p></p>
<div class="alert">
Be careful, the default values of the python constructor may not be the same as in the native library.
</div>

<h4 id="quick-example">QUICK EXAMPLE</h4>

<p>Here we give an application of the <code class="language-c++ highlighter-rouge"><span class="n">SPOT</span></code> algorithm. The script and the data are available on the github repository <a href="https://github.com/asiffer/python3-libspot">python3-libspot</a> (in the ‘example’ folder).</p>

<p>In this example we monitor the ratio of SYN packets in a network traffic capture. The original <code class="language-c++ highlighter-rouge"><span class="p">.</span><span class="n">pcap</span></code> files are provided by the <a href="http://www.fukuda-lab.org/mawilab/v1.1/index.html">MAWI</a> platform. Here we use aggregated data (measures over time slots) from two consecutive capture days (August 17 and 18, 2012).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">pyspot</span> <span class="k">as</span> <span class="n">ps</span> <span class="c"># name of the python3 package</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c"># loading data</span>
<span class="n">MAWI_17</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"mawi_170812_50_50.csv"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">MAWI_18</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"mawi_180812_50_50.csv"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c"># we keep only the ratio of SYN packets</span>
<span class="n">rSYN_17</span> <span class="o">=</span> <span class="n">MAWI_17</span><span class="p">[</span><span class="s">'rSYN'</span><span class="p">]</span>
<span class="n">rSYN_18</span> <span class="o">=</span> <span class="n">MAWI_18</span><span class="p">[</span><span class="s">'rSYN'</span><span class="p">]</span>

<span class="c"># initialization of the Spot object</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">5e-4</span>
<span class="n">n_init</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">spot</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">Spot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">n_init</span><span class="p">,</span> <span class="n">up</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">down</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="c">## CALIBRATION</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rSYN_17</span><span class="p">[</span><span class="o">-</span><span class="n">n_init</span><span class="p">:]:</span>
	<span class="n">spot</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>


<span class="c">## ANOMALY DETECTION</span>

<span class="c"># we init some structure to log what flags the algorithm</span>
<span class="n">up_threshold</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">rSYN_18</span><span class="p">)</span>
<span class="n">anomalies_x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">anomalies_y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rSYN_18</span><span class="p">:</span>
	<span class="n">event</span> <span class="o">=</span> <span class="n">spot</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
	
	<span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># anomaly case</span>
		<span class="n">anomalies_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="n">anomalies_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
		
	<span class="n">up_threshold</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spot</span><span class="o">.</span><span class="n">get_upper_threshold</span><span class="p">()</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>

<span class="c"># Plotting stuff </span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rSYN_18</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#1B4B5A"</span><span class="p">)</span>
<span class="n">f1</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_threshold</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">'dashed'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#AE81FF"</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">anomalies_x</span><span class="p">,</span> <span class="n">anomalies_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#F55449"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">],</span> <span class="p">[</span><span class="s">'Threshold'</span><span class="p">,</span> <span class="s">'Anomalies'</span><span class="p">])</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">18001</span><span class="p">,</span><span class="mi">3000</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">901</span><span class="p">,</span><span class="mi">150</span><span class="p">))</span> <span class="c"># we change the ticks to make it corresponds to the true time : 1 it = 50 ms</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Time (s)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Ratio of SYN packets'</span><span class="p">)</span>
</code></pre></div></div>

<p>The output is given below. In this case, we can notice that the algorithm builds a relevant threshold able to flag abnormal peaks.</p>

<p><img src="/libspot/assets/example.svg" alt="Matplotlib" /></p>

</main>
		</body>
		<footer>
	by @sr
</footer>

	</div>
</html>
